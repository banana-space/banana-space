define("monaco-editor",["exports","vs/editor/editor.main"],function(e,n){Object.assign(e,n)}),define("diff",["exports"],function(e){"use strict";function n(){}function t(e,n,t,i,o){for(var r=0,l=n.length,a=0,s=0;r<l;r++){var d=n[r];if(d.removed){if(d.value=e.join(i.slice(s,s+d.count)),s+=d.count,r&&n[r-1].added){var u=n[r-1];n[r-1]=n[r],n[r]=u}}else{if(!d.added&&o){var m=t.slice(a,a+d.count);m=m.map(function(e,n){var t=i[s+n];return t.length>e.length?t:e}),d.value=e.join(m)}else d.value=e.join(t.slice(a,a+d.count));a+=d.count,d.added||(s+=d.count)}}var c=n[l-1];return l>1&&"string"==typeof c.value&&(c.added||c.removed)&&e.equals("",c.value)&&(n[l-2].value+=c.value,n.pop()),n}n.prototype={diff:function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i.callback;"function"==typeof i&&(o=i,i={}),this.options=i;var r=this;function l(e){return o?(setTimeout(function(){o(void 0,e)},0),!0):e}e=this.castInput(e),n=this.castInput(n),e=this.removeEmpty(this.tokenize(e));var a=(n=this.removeEmpty(this.tokenize(n))).length,s=e.length,d=1,u=a+s,m=[{newPos:-1,components:[]}],c=this.extractCommon(m[0],n,e,0);if(m[0].newPos+1>=a&&c+1>=s)return l([{value:this.join(n),count:n.length}]);function g(){for(var i=-1*d;i<=d;i+=2){var o=void 0,u=m[i-1],c=m[i+1],g=(c?c.newPos:0)-i;u&&(m[i-1]=void 0);var f=u&&u.newPos+1<a,h=c&&0<=g&&g<s;if(f||h){if(!f||h&&u.newPos<c.newPos?(o={newPos:(p=c).newPos,components:p.components.slice(0)},r.pushComponent(o.components,void 0,!0)):((o=u).newPos++,r.pushComponent(o.components,!0,void 0)),g=r.extractCommon(o,n,e,i),o.newPos+1>=a&&g+1>=s)return l(t(r,o.components,n,e,r.useLongestToken));m[i]=o}else m[i]=void 0}var p;d++}if(o)!function e(){setTimeout(function(){if(d>u)return o();g()||e()},0)}();else for(;d<=u;){var f=g();if(f)return f}},pushComponent:function(e,n,t){var i=e[e.length-1];i&&i.added===n&&i.removed===t?e[e.length-1]={count:i.count+1,added:n,removed:t}:e.push({count:1,added:n,removed:t})},extractCommon:function(e,n,t,i){for(var o=n.length,r=t.length,l=e.newPos,a=l-i,s=0;l+1<o&&a+1<r&&this.equals(n[l+1],t[a+1]);)l++,a++,s++;return s&&e.components.push({count:s}),e.newPos=l,a},equals:function(e,n){return this.options.comparator?this.options.comparator(e,n):e===n||this.options.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],t=0;t<e.length;t++)e[t]&&n.push(e[t]);return n},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};var i=new n;function o(e,n){if("function"==typeof e)n.callback=e;else if(e)for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}var r=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,l=/\S/,a=new n;a.equals=function(e,n){return this.options.ignoreCase&&(e=e.toLowerCase(),n=n.toLowerCase()),e===n||this.options.ignoreWhitespace&&!l.test(e)&&!l.test(n)},a.tokenize=function(e){for(var n=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<n.length-1;t++)!n[t+1]&&n[t+2]&&r.test(n[t])&&r.test(n[t+2])&&(n[t]+=n[t+2],n.splice(t+1,2),t--);return n};var s=new n;function d(e,n,t){return s.diff(e,n,t)}s.tokenize=function(e){var n=[],t=e.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var i=0;i<t.length;i++){var o=t[i];i%2&&!this.options.newlineIsToken?n[n.length-1]+=o:(this.options.ignoreWhitespace&&(o=o.trim()),n.push(o))}return n};var u=new n;u.tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)};var m=new n;function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return f(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}m.tokenize=function(e){return e.split(/([{}:;,]|\s+)/)};var h=Object.prototype.toString,p=new n;function v(e,n,t,i,o){var r,l;for(n=n||[],t=t||[],i&&(e=i(o,e)),r=0;r<n.length;r+=1)if(n[r]===e)return t[r];if("[object Array]"===h.call(e)){for(n.push(e),l=new Array(e.length),t.push(l),r=0;r<e.length;r+=1)l[r]=v(e[r],n,t,i,o);return n.pop(),t.pop(),l}if(e&&e.toJSON&&(e=e.toJSON()),"object"===c(e)&&null!==e){n.push(e),l={},t.push(l);var a,s=[];for(a in e)e.hasOwnProperty(a)&&s.push(a);for(s.sort(),r=0;r<s.length;r+=1)l[a=s[r]]=v(e[a],n,t,i,a);n.pop(),t.pop()}else l=e;return l}p.useLongestToken=!0,p.tokenize=s.tokenize,p.castInput=function(e){var n=this.options,t=n.undefinedReplacement,i=n.stringifyReplacer,o=void 0===i?function(e,n){return void 0===n?t:n}:i;return"string"==typeof e?e:JSON.stringify(v(e,null,null,o),o,"  ")},p.equals=function(e,t){return n.prototype.equals.call(p,e.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))};var b=new n;function x(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.split(/\r\n|[\n\v\f\r\x85]/),i=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],o=[],r=0;function l(){var e={};for(o.push(e);r<t.length;){var i=t[r];if(/^(\-\-\-|\+\+\+|@@)\s/.test(i))break;var l=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(i);l&&(e.index=l[1]),r++}for(a(e),a(e),e.hunks=[];r<t.length;){var d=t[r];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(d))break;if(/^@@/.test(d))e.hunks.push(s());else{if(d&&n.strict)throw new Error("Unknown line "+(r+1)+" "+JSON.stringify(d));r++}}}function a(e){var n=/^(---|\+\+\+)\s+(.*)$/.exec(t[r]);if(n){var i="---"===n[1]?"old":"new",o=n[2].split("\t",2),l=o[0].replace(/\\\\/g,"\\");/^".*"$/.test(l)&&(l=l.substr(1,l.length-2)),e[i+"FileName"]=l,e[i+"Header"]=(o[1]||"").trim(),r++}}function s(){var e=r,o=t[r++].split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),l={oldStart:+o[1],oldLines:void 0===o[2]?1:+o[2],newStart:+o[3],newLines:void 0===o[4]?1:+o[4],lines:[],linedelimiters:[]};0===l.oldLines&&(l.oldStart+=1),0===l.newLines&&(l.newStart+=1);for(var a=0,s=0;r<t.length&&!(0===t[r].indexOf("--- ")&&r+2<t.length&&0===t[r+1].indexOf("+++ ")&&0===t[r+2].indexOf("@@"));r++){var d=0==t[r].length&&r!=t.length-1?" ":t[r][0];if("+"!==d&&"-"!==d&&" "!==d&&"\\"!==d)break;l.lines.push(t[r]),l.linedelimiters.push(i[r]||"\n"),"+"===d?a++:"-"===d?s++:" "===d&&(a++,s++)}if(a||1!==l.newLines||(l.newLines=0),s||1!==l.oldLines||(l.oldLines=0),n.strict){if(a!==l.newLines)throw new Error("Added line count did not match for hunk at line "+(e+1));if(s!==l.oldLines)throw new Error("Removed line count did not match for hunk at line "+(e+1))}return l}for(;r<t.length;)l();return o}function T(e,n,t){var i=!0,o=!1,r=!1,l=1;return function a(){if(i&&!r){if(o?l++:i=!1,e+l<=t)return l;r=!0}if(!o)return r||(i=!0),n<=e-l?-l++:(o=!0,a())}}function C(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof n&&(n=x(n)),Array.isArray(n)){if(n.length>1)throw new Error("applyPatch only works with a single input.");n=n[0]}var i,o,r=e.split(/\r\n|[\n\v\f\r\x85]/),l=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],a=n.hunks,s=t.compareLine||function(e,n,t,i){return n===i},d=0,u=t.fuzzFactor||0,m=0,c=0;function g(e,n){for(var t=0;t<e.lines.length;t++){var i=e.lines[t],o=i.length>0?i[0]:" ",l=i.length>0?i.substr(1):i;if(" "===o||"-"===o){if(!s(n+1,r[n],o,l)&&++d>u)return!1;n++}}return!0}for(var f=0;f<a.length;f++){for(var h=a[f],p=r.length-h.oldLines,v=0,b=c+h.oldStart-1,C=T(b,m,p);void 0!==v;v=C())if(g(h,b+v)){h.offset=c+=v;break}if(void 0===v)return!1;m=h.offset+h.oldStart+h.oldLines}for(var w=0,y=0;y<a.length;y++){var L=a[y],k=L.oldStart+L.offset+w-1;w+=L.newLines-L.oldLines;for(var M=0;M<L.lines.length;M++){var $=L.lines[M],N=$.length>0?$[0]:" ",S=$.length>0?$.substr(1):$,P=L.linedelimiters[M];if(" "===N)k++;else if("-"===N)r.splice(k,1),l.splice(k,1);else if("+"===N)r.splice(k,0,S),l.splice(k,0,P),k++;else if("\\"===N){var _=L.lines[M-1]?L.lines[M-1][0]:null;"+"===_?i=!0:"-"===_&&(o=!0)}}}if(i)for(;!r[r.length-1];)r.pop(),l.pop();else o&&(r.push(""),l.push("\n"));for(var I=0;I<r.length-1;I++)r[I]=r[I]+l[I];return r.join("")}function w(e,n,t,i,o,r,l){l||(l={}),void 0===l.context&&(l.context=4);var a=d(t,i,l);function s(e){return e.map(function(e){return" "+e})}a.push({value:"",lines:[]});for(var u=[],m=0,c=0,f=[],h=1,p=1,v=function(e){var n=a[e],o=n.lines||n.value.replace(/\n$/,"").split("\n");if(n.lines=o,n.added||n.removed){var r;if(!m){var d=a[e-1];m=h,c=p,d&&(f=l.context>0?s(d.lines.slice(-l.context)):[],m-=f.length,c-=f.length)}(r=f).push.apply(r,g(o.map(function(e){return(n.added?"+":"-")+e}))),n.added?p+=o.length:h+=o.length}else{if(m)if(o.length<=2*l.context&&e<a.length-2){var v;(v=f).push.apply(v,g(s(o)))}else{var b,x=Math.min(o.length,l.context);(b=f).push.apply(b,g(s(o.slice(0,x))));var T={oldStart:m,oldLines:h-m+x,newStart:c,newLines:p-c+x,lines:f};if(e>=a.length-2&&o.length<=l.context){var C=/\n$/.test(t),w=/\n$/.test(i),y=0==o.length&&f.length>T.oldLines;!C&&y&&t.length>0&&f.splice(T.oldLines,0,"\\ No newline at end of file"),(C||y)&&w||f.push("\\ No newline at end of file")}u.push(T),m=0,c=0,f=[]}h+=o.length,p+=o.length}},b=0;b<a.length;b++)v(b);return{oldFileName:e,newFileName:n,oldHeader:o,newHeader:r,hunks:u}}function y(e,n,t,i,o,r,l){return function(e){var n=[];e.oldFileName==e.newFileName&&n.push("Index: "+e.oldFileName),n.push("==================================================================="),n.push("--- "+e.oldFileName+(void 0===e.oldHeader?"":"\t"+e.oldHeader)),n.push("+++ "+e.newFileName+(void 0===e.newHeader?"":"\t"+e.newHeader));for(var t=0;t<e.hunks.length;t++){var i=e.hunks[t];0===i.oldLines&&(i.oldStart-=1),0===i.newLines&&(i.newStart-=1),n.push("@@ -"+i.oldStart+","+i.oldLines+" +"+i.newStart+","+i.newLines+" @@"),n.push.apply(n,i.lines)}return n.join("\n")+"\n"}(w(e,n,t,i,o,r,l))}function L(e,n){if(n.length>e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function k(e){var n=function e(n){var t=0;var i=0;n.forEach(function(n){if("string"!=typeof n){var o=e(n.mine),r=e(n.theirs);void 0!==t&&(o.oldLines===r.oldLines?t+=o.oldLines:t=void 0),void 0!==i&&(o.newLines===r.newLines?i+=o.newLines:i=void 0)}else void 0===i||"+"!==n[0]&&" "!==n[0]||i++,void 0===t||"-"!==n[0]&&" "!==n[0]||t++});return{oldLines:t,newLines:i}}(e.lines),t=n.oldLines,i=n.newLines;void 0!==t?e.oldLines=t:delete e.oldLines,void 0!==i?e.newLines=i:delete e.newLines}function M(e,n){if("string"==typeof e){if(/^@@/m.test(e)||/^Index:/m.test(e))return x(e)[0];if(!n)throw new Error("Must provide a base reference or pass in a patch");return w(void 0,void 0,n,e)}return e}function $(e){return e.newFileName&&e.newFileName!==e.oldFileName}function N(e,n,t){return n===t?n:(e.conflict=!0,{mine:n,theirs:t})}function S(e,n){return e.oldStart<n.oldStart&&e.oldStart+e.oldLines<n.oldStart}function P(e,n){return{oldStart:e.oldStart,oldLines:e.oldLines,newStart:e.newStart+n,newLines:e.newLines,lines:e.lines}}function _(e,n,t,i,o){var r={offset:n,lines:t,index:0},l={offset:i,lines:o,index:0};for(O(e,r,l),O(e,l,r);r.index<r.lines.length&&l.index<l.lines.length;){var a=r.lines[r.index],s=l.lines[l.index];if("-"!==a[0]&&"+"!==a[0]||"-"!==s[0]&&"+"!==s[0])if("+"===a[0]&&" "===s[0]){var d;(d=e.lines).push.apply(d,g(z(r)))}else if("+"===s[0]&&" "===a[0]){var u;(u=e.lines).push.apply(u,g(z(l)))}else"-"===a[0]&&" "===s[0]?A(e,r,l):"-"===s[0]&&" "===a[0]?A(e,l,r,!0):a===s?(e.lines.push(a),r.index++,l.index++):D(e,z(r),z(l));else I(e,r,l)}j(e,r),j(e,l),k(e)}function I(e,n,t){var i,o,r=z(n),l=z(t);if(E(r)&&E(l)){var a,s;if(L(r,l)&&F(t,r,r.length-l.length))return void(a=e.lines).push.apply(a,g(r));if(L(l,r)&&F(n,l,l.length-r.length))return void(s=e.lines).push.apply(s,g(l))}else if(o=l,(i=r).length===o.length&&L(i,o)){var d;return void(d=e.lines).push.apply(d,g(r))}D(e,r,l)}function A(e,n,t,i){var o,r=z(n),l=function(e,n){var t=[],i=[],o=0,r=!1,l=!1;for(;o<n.length&&e.index<e.lines.length;){var a=e.lines[e.index],s=n[o];if("+"===s[0])break;if(r=r||" "!==a[0],i.push(s),o++,"+"===a[0])for(l=!0;"+"===a[0];)t.push(a),a=e.lines[++e.index];s.substr(1)===a.substr(1)?(t.push(a),e.index++):l=!0}"+"===(n[o]||"")[0]&&r&&(l=!0);if(l)return t;for(;o<n.length;)i.push(n[o++]);return{merged:i,changes:t}}(t,r);l.merged?(o=e.lines).push.apply(o,g(l.merged)):D(e,i?l:r,i?r:l)}function D(e,n,t){e.conflict=!0,e.lines.push({conflict:!0,mine:n,theirs:t})}function O(e,n,t){for(;n.offset<t.offset&&n.index<n.lines.length;){var i=n.lines[n.index++];e.lines.push(i),n.offset++}}function j(e,n){for(;n.index<n.lines.length;){var t=n.lines[n.index++];e.lines.push(t)}}function z(e){for(var n=[],t=e.lines[e.index][0];e.index<e.lines.length;){var i=e.lines[e.index];if("-"===t&&"+"===i[0]&&(t="+"),t!==i[0])break;n.push(i),e.index++}return n}function E(e){return e.reduce(function(e,n){return e&&"-"===n[0]},!0)}function F(e,n,t){for(var i=0;i<t;i++){var o=n[n.length-t+i].substr(1);if(e.lines[e.index+i]!==" "+o)return!1}return e.index+=t,!0}b.tokenize=function(e){return e.slice()},b.join=b.removeEmpty=function(e){return e},e.Diff=n,e.applyPatch=C,e.applyPatches=function(e,n){"string"==typeof e&&(e=x(e));var t=0;!function i(){var o=e[t++];if(!o)return n.complete();n.loadFile(o,function(e,t){if(e)return n.complete(e);var r=C(t,o,n);n.patched(o,r,function(e){if(e)return n.complete(e);i()})})}()},e.canonicalize=v,e.convertChangesToDMP=function(e){for(var n,t,i=[],o=0;o<e.length;o++)t=(n=e[o]).added?1:n.removed?-1:0,i.push([t,n.value]);return i},e.convertChangesToXML=function(e){for(var n=[],t=0;t<e.length;t++){var i=e[t];i.added?n.push("<ins>"):i.removed&&n.push("<del>"),n.push((o=i.value,void 0,o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"))),i.added?n.push("</ins>"):i.removed&&n.push("</del>")}var o;return n.join("")},e.createPatch=function(e,n,t,i,o,r){return y(e,e,n,t,i,o,r)},e.createTwoFilesPatch=y,e.diffArrays=function(e,n,t){return b.diff(e,n,t)},e.diffChars=function(e,n,t){return i.diff(e,n,t)},e.diffCss=function(e,n,t){return m.diff(e,n,t)},e.diffJson=function(e,n,t){return p.diff(e,n,t)},e.diffLines=d,e.diffSentences=function(e,n,t){return u.diff(e,n,t)},e.diffTrimmedLines=function(e,n,t){var i=o(t,{ignoreWhitespace:!0});return s.diff(e,n,i)},e.diffWords=function(e,n,t){return t=o(t,{ignoreWhitespace:!0}),a.diff(e,n,t)},e.diffWordsWithSpace=function(e,n,t){return a.diff(e,n,t)},e.merge=function(e,n,t){e=M(e,t),n=M(n,t);var i={};(e.index||n.index)&&(i.index=e.index||n.index),(e.newFileName||n.newFileName)&&($(e)?$(n)?(i.oldFileName=N(i,e.oldFileName,n.oldFileName),i.newFileName=N(i,e.newFileName,n.newFileName),i.oldHeader=N(i,e.oldHeader,n.oldHeader),i.newHeader=N(i,e.newHeader,n.newHeader)):(i.oldFileName=e.oldFileName,i.newFileName=e.newFileName,i.oldHeader=e.oldHeader,i.newHeader=e.newHeader):(i.oldFileName=n.oldFileName||e.oldFileName,i.newFileName=n.newFileName||e.newFileName,i.oldHeader=n.oldHeader||e.oldHeader,i.newHeader=n.newHeader||e.newHeader)),i.hunks=[];for(var o=0,r=0,l=0,a=0;o<e.hunks.length||r<n.hunks.length;){var s=e.hunks[o]||{oldStart:1/0},d=n.hunks[r]||{oldStart:1/0};if(S(s,d))i.hunks.push(P(s,l)),o++,a+=s.newLines-s.oldLines;else if(S(d,s))i.hunks.push(P(d,a)),r++,l+=d.newLines-d.oldLines;else{var u={oldStart:Math.min(s.oldStart,d.oldStart),oldLines:0,newStart:Math.min(s.newStart+l,d.oldStart+a),newLines:0,lines:[]};_(u,s.oldStart,s.lines,d.oldStart,d.lines),r++,o++,i.hunks.push(u)}}return i},e.parsePatch=x,e.structuredPatch=w,Object.defineProperty(e,"__esModule",{value:!0})});var __awaiter=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))(function(o,r){function l(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(l,a)}s((i=i.apply(e,n||[])).next())})};function docReady(e){let n=function(){window.$?e():setTimeout(n,250)};"complete"===document.readyState||"interactive"===document.readyState?setTimeout(n,1):document.addEventListener("DOMContentLoaded",n)}define("lib/common",["require","exports","monaco-editor"],function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.insertText=n.options=void 0,n.options={suggestionsLimit:1e4,maxParsedLineLength:1e4,locale:"en"},n.insertText=function(e,n,i,o,r){null!=o||(o=n),e.executeEdits(null,[{range:{startLineNumber:n.lineNumber,endLineNumber:n.lineNumber,startColumn:n.column,endColumn:n.column+(null!=r?r:0)},text:i}],[new t.Selection(o.lineNumber,o.column,o.lineNumber,o.column)])}}),define("lib/data",["require","exports","lib/common"],function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initFileUrl=n.imports=n.getString=n.strings=n.snippetDictionary=n.environmentDictionary=n.commandDictionary=n.mathEnvironments=n.envStarCommands=n.envCommands=void 0,n.envCommands=["\\begin","\\end","\\envdef","\\newenvironment","\\newtheorem","\\renewenvironment"],n.envStarCommands=["\\newenvironment*","\\renewenvironment*","\\newtheorem*"],n.mathEnvironments=["align","align*","equation","equation*","multline","multline*"],n.commandDictionary={"\\AA":{mode:"T"},"\\addtocounter":{mode:"MT",signature:"\\addtocounter{计数器}{值}"},"\\adef":{mode:"MT",signature:"\\adef<命令><参数>{定义}"},"\\AE":{mode:"T"},"\\ae":{mode:"T"},"\\alet":{mode:"MT",signature:"\\alet<命令><命令>"},"\\Alph":{mode:"MT",signature:"\\Alph{计数器}"},"\\alph":{mode:"MT",signature:"\\alph{计数器}"},"\\Alpha":{mode:"M"},"\\alpha":{mode:"M"},"\\arabic":{mode:"MT",signature:"\\arabic{计数器}"},"\\atop":{mode:"M",signature:"{#1 \\atop #2}",deprecated:!0},"\\backslash":{mode:"T"},"\\begin":{mode:"MT",insertText:"\\begin{",signature:"\\begin{环境}"},"\\begingroup":{mode:"MT"},"\\bf":{mode:"T"},"\\bibitem":{mode:"T",signature:"\\bibitem[编号]{标签}"},"\\bullet":{mode:"T"},"\\c":{mode:"T",signature:"\\c{}"},"\\cite":{mode:"T",signature:"\\cite[内容]{标签}"},"\\code":{mode:"T",signature:"\\code{代码}"},"\\codeblock":{mode:"T",signature:"\\codeblock{代码}"},"\\color":{mode:"T",signature:"\\color{颜色代码}"},"\\colour":{mode:"T",signature:"\\colour{颜色代码}"},"\\corollaryname":{mode:"MT"},"\\dagger":{mode:"MT"},"\\ddagger":{mode:"MT"},"\\def":{mode:"MT",signature:"\\def<命令><参数>{定义}"},"\\definitionname":{mode:"MT"},"\\edef":{mode:"MT",signature:"\\edef<命令><参数>{定义}"},"\\em":{mode:"T"},"\\emph":{mode:"T",signature:"\\emph{文字}"},"\\end":{mode:"MT",signature:"\\end{环境}"},"\\endgroup":{mode:"MT"},"\\english":{mode:"MT",signature:"\\english[]"},"\\envadef":{mode:"MT",signature:"\\envadef{环境}{参数}{开始}{结束}"},"\\envdef":{mode:"MT",signature:"\\envdef{环境}{参数}{开始}{结束}"},"\\envpdef":{mode:"MT",signature:"\\envpdef{环境}{参数}{开始}{结束}"},"\\eqno":{mode:"M"},"\\eqref":{mode:"T",signature:"\\eqref{}"},"\\floatright":{mode:"T",signature:"\\floatright{内容}"},"\\gdef":{mode:"MT",signature:"\\gdef<命令><参数>{定义}"},"\\glet":{mode:"MT",signature:"\\glet<命令><命令>"},"\\H":{mode:"T",signature:"\\H{}"},"\\href":{mode:"T",signature:"\\href{链接}{文字}"},"\\i":{mode:"MT"},"\\it":{mode:"T"},"\\item":{mode:"T",signature:"\\item[编号]"},"\\j":{mode:"MT"},"\\l":{mode:"T"},"\\L":{mode:"T"},"\\label":{mode:"T",signature:"\\label{标签}"},"\\lang":{mode:"T",signature:"\\lang{语言代码}{文字}"},"\\lemmaname":{mode:"T"},"\\leqno":{mode:"M"},"\\let":{mode:"MT",signature:"\\let<命令><命令>"},"\\md":{mode:"T"},"\\newcommand":{mode:"MT",signature:"\\newcommand<命令>[参数]{定义}"},"\\newcounter":{mode:"MT",signature:"\\newcounter[计数器]"},"\\newenvironment":{mode:"MT",signature:"\\newenvironment{环境}[参数]{开始}{结束}"},"\\newtheorem":{mode:"MT",signature:"\\newtheorem{环境}{名称}"},"\\nosectionnumbers":{mode:"T"},"\\numbersections":{mode:"T"},"\\numbersubsections":{mode:"T"},"\\numbersubsubsections":{mode:"T"},"\\numberwithin":{mode:"MT",signature:"\\numberwithin{子计数器}{父计数器}"},"\\o":{mode:"T"},"\\O":{mode:"T"},"\\oe":{mode:"T"},"\\OE":{mode:"T"},"\\operatorname":{mode:"M",signature:"\\operatorname{文字}"},"\\operatornamewithlimits":{mode:"M",signature:"\\operatornamewithlimits{文字}"},"\\par":{mode:"T"},"\\pdef":{mode:"MT",signature:"\\pdef<命令><参数>{定义}"},"\\plet":{mode:"MT",signature:"\\plet<命令><命令>"},"\\proofname":{mode:"T"},"\\propositionname":{mode:"T"},"\\qed":{mode:"T"},"\\qedhere":{mode:"MT"},"\\qedsymbol":{mode:"T"},"\\qquad":{mode:"T"},"\\quad":{mode:"T"},"\\r":{mode:"T",signature:"\\r{}"},"\\ref":{mode:"MT",signature:"\\ref{标签}"},"\\refname":{mode:"T"},"\\refstepcounter":{mode:"MT",signature:"\\refstepcounter{计数器}"},"\\remarkname":{mode:"T"},"\\renewcommand":{mode:"MT",signature:"\\renewcommand<命令>[参数]{定义}"},"\\renewenvironment":{mode:"MT",signature:"\\renewenvironment{环境}[参数]{开始}{结束}"},"\\reqno":{mode:"M"},"\\rm":{mode:"T"},"\\Roman":{mode:"MT",signature:"\\Roman{计数器}"},"\\roman":{mode:"MT",signature:"\\roman{计数器}"},"\\S":{mode:"T"},"\\section":{mode:"T",signature:"\\section{标题}"},"\\setcounter":{mode:"MT",signature:"\\setcounter{计数器}"},"\\setdisplaytitle":{mode:"T",signature:"\\setdisplaytitle{文字}"},"\\sethtmltitle":{mode:"T",signature:"\\sethtmltitle{文字}"},"\\setlanguage":{mode:"T",signature:"\\setlanguage{语言代码}"},"\\size":{mode:"T",signature:"\\size{大小}"},"\\ss":{mode:"T"},"\\SS":{mode:"T"},"\\stepcounter":{mode:"T",signature:"\\stepcounter{计数器}"},"\\subpage":{mode:"T",signature:"\\subpage[编号]{页标题}[文字]"},"\\subsection":{mode:"T",signature:"\\subsection{标题}"},"\\subsubpage":{mode:"T",signature:"\\subsubpage[编号]{页标题}[文字]"},"\\subsubsection":{mode:"T",signature:"\\subsubsection{标题}"},"\\subsubsubpage":{mode:"T",signature:"\\subsubsubpage[编号]{页标题}[文字]"},"\\tdef":{mode:"MT",signature:"\\tdef<命令><参数>{定义}"},"\\textbf":{mode:"T",signature:"\\textbf{文字}"},"\\textcolor":{mode:"T",signature:"\\textcolor{颜色}{文字}"},"\\textcolour":{mode:"T",signature:"\\textcolour{颜色}{文字}"},"\\textit":{mode:"T",signature:"\\textit{文字}"},"\\textmd":{mode:"T",signature:"\\textmd{文字}"},"\\textrm":{mode:"T",signature:"\\textrm{文字}"},"\\textsize":{mode:"T",signature:"\\textsize{大小}{文字}"},"\\thmprefix":{mode:"T"},"\\tikz":{mode:"T",signature:"\\tikz{代码}"},"\\tlet":{mode:"MT",signature:"\\tlet<命令><命令>"},"\\tocname":{mode:"T"},"\\u":{mode:"T",signature:"\\u{}"},"\\url":{mode:"T",signature:"\\url{链接}"},"\\v":{mode:"T",signature:"\\v{}"},"\\xeqno":{mode:"M"}},n.environmentDictionary={align:{mode:"T"},"align*":{mode:"T"}},n.snippetDictionary={"\\left(":{mode:"M",insertText:"\\left( ${0} \\right)",signature:"\\left( ... \\right)"}},n.strings={zh:{"unmatched-bracket":"'${1}' 没有配对。"}},n.getString=function(e,...i){var o;let r=(null!==(o=n.strings[t.options.locale])&&void 0!==o?o:n.strings.zh)[e];if(!r)return"";let l=r;l=l.replace(/\$(_+)\{/g,"$$__$1{");for(let e=0;e<i.length;e++)l=l.replace("${"+(e+1)+"}",i[e].replace(/\$(_*)\{/g,"$$__$1{"));return l.replace(/\$__(_*)\{/g,"$$$1{")},n.imports=[],n.initFileUrl="https://raw.githubusercontent.com/banana-space/btex/main/src/lib/init.btx"}),define("lib/StructureAnalyser",["require","exports","lib/common"],function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.btexStructureAnalyser=void 0,n.btexStructureAnalyser={analyse:function(e,n){var i,o,r;let l={},a=null!==(i=null==n?void 0:n.startLineNumber)&&void 0!==i?i:1,s=null!==(o=null==n?void 0:n.endLineNumber)&&void 0!==o?o:e.getLineCount();for(let n=a;n<=s;n++){null!==(r=l[n])&&void 0!==r||(l[n]=[]);let i=l[n],o=e.getLineContent(n);if(o.length>t.options.maxParsedLineLength)continue;o=o.replace(/\\\\/g,"  ").replace(/(^|[^\\])%.*/,"$1");let a=1;for(;o.length>0;)switch(o[0]){case"{":case"}":case"$":i.push({tag:o[0],startColumn:a,endColumn:a+1}),o=o.substring(1),a++;continue;case"\\":if("[]()".includes(o[1])){i.push({tag:"\\"+o[1],startColumn:a,endColumn:a+2}),o=o.substring(2),a+=2;continue}let e=o.match(/^\\(begin|end)\s*(\{[^\{\}\\]*\})/);if(e){i.push({tag:"\\"+e[1]+e[2],startColumn:a,endColumn:a+e[0].length}),o=o.substring(e[0].length),a+=e[0].length;continue}if(e=o.match(/^(\\@?(re)?newcommand(\s*\*)?)\s*\{\s*(\\[a-zA-Z]+|.?)?\s*\}/)||o.match(/^(\\@?([aegpt@]?def|(re)?newcommand(\s*\*)?))/)){i.push({tag:"def",startColumn:a,endColumn:a+e[1].length}),o=o.substring(e[1].length),a+=e[1].length;continue}if(e=o.match(/^\\(?:@?env[ap]?(def)|(re)?newenvironment(\s*\*)?)/)){i.push({tag:"def"===e[1]?"envdef":"newenv",startColumn:a,endColumn:a+e[0].length}),o=o.substring(e[0].length),a+=e[0].length;continue}o=o.substring(2),a+=2;continue;case"#":let n=o.match(/^#+.?/),t=n?n[0].length:1;o=o.substring(t),a+=t;continue;default:o=o.substring(1),a++;continue}}return l}}}),define("lib/structure",["require","exports","monaco-editor","lib/data"],function(e,n,t,i){"use strict";function o(e,n,t){if(t<=0)return n;let i=e._analyserResult;if(!i)return;let o=0,r=i[n.lineNumber];for(;o<r.length&&r[o].startColumn<n.column;)o++;let l=0,a=e.getLineCount();for(let e=n.lineNumber;e<=a;e++){let r=i[e];for(let i=e===n.lineNumber?o:0;i<r.length;i++)if("{"===r[i].tag)l++;else if("}"===r[i].tag){if(0===--l&&0===--t)return{lineNumber:e,column:r[i].startColumn};if(-1===l)return}}}function r(e,n){return{startLineNumber:n,endLineNumber:n,startColumn:e.startColumn,endColumn:e.endColumn}}function l(e){return"{"===e?"}":"\\("===e?"\\)":"\\["===e?"\\]":e.startsWith("\\begin")?e.replace("\\begin","\\end"):""}Object.defineProperty(n,"__esModule",{value:!0}),n.validateModel=n.getHighlightBrackets=n.detectMode=n.jumpOverGroups=n.matchEnvironment=void 0,n.matchEnvironment=function(e,n,t,i){var o;if(1!==i&&-1!==i)return;let r=[n],l=e._analyserResult;if(!l)return;let a=0,s=l[t.lineNumber];for(;a<s.length&&s[a].startColumn<t.column;)a++;if(!((null===(o=s[--a])||void 0===o?void 0:o.endColumn)>=t.column))return;let d=e.getLineCount();for(let e=t.lineNumber;e>0&&e<=d;e+=i){let n=l[e];for(let o=e===t.lineNumber?a+i:1===i?0:n.length-1;o>=0&&o<n.length;o+=i){let t=n[o].tag.match(/^\\(begin|end)\{([^\{\}\\]*)\}$/);if(t)if("begin"===t[1]==(1===i))r.push(t[2]);else{let i=r.pop();if(null!==i&&i!==t[2])return;if(0===r.length)return{lineNumber:e,column:n[o].endColumn-t[2].length-1}}}}},n.jumpOverGroups=o,n.detectMode=function(e,n){var t,r;let l=e._analyserResult;if(!l)return"T";let a=[];for(let s=1;s<=n.lineNumber;s++){let d=l[s];s===n.lineNumber&&(d=d.filter(e=>e.endColumn<=n.column));for(let u=0;u<d.length;u++){let m=d[u];if("$"===m.tag){let e="$"===(null===(t=d[u+1])||void 0===t?void 0:t.tag)&&(null===(r=d[u+1])||void 0===r?void 0:r.startColumn)===m.endColumn;a.length>0&&"$"===a[a.length-1]?a.pop():a.length>0&&e&&"$$"===a[a.length-1]?(a.pop(),u++):(a.push(e?"$$":"$"),e&&u++)}else if("\\("===m.tag)a.push("\\(");else if("\\["===m.tag)a.push("\\[");else if("{"===m.tag)a.push("{");else if("\\)"===m.tag)"\\("===a[a.length-1]&&a.pop();else if("\\]"===m.tag)"\\["===a[a.length-1]&&a.pop();else if("}"===m.tag)for(;a.length>0&&"{"!==a.pop(););else if(m.tag.startsWith("\\begin")){let e=m.tag.substring(7,m.tag.length-1);i.mathEnvironments.join("|").includes(e)&&!e.includes("|")&&a.push(e)}else if(m.tag.startsWith("\\end")){let e=m.tag.substring(5,m.tag.length-1);a.length>0&&a[a.length-1]===e&&a.pop()}else if("def"===m.tag||"newenv"===m.tag||"envdef"===m.tag){let t=o(e,{lineNumber:s,column:m.startColumn},"def"===m.tag?1:"newenv"===m.tag?3:4);if(t){if(d=l[s=t.lineNumber],s>n.lineNumber||s===n.lineNumber&&t.column>=n.column)return"T";for(s===n.lineNumber&&(d=d.filter(e=>e.endColumn<=n.column)),u=0;d[u]&&d[u].startColumn<=t.column;)u++;u--}}}}return a.filter(e=>"{"!==e).length>0?"M":"T"},n.getHighlightBrackets=function(e,n){var t,i;let o=[],a=e._analyserResult;if(!a)return[];let s=e.getLineCount(),d=!1;for(let e=1;e<=s;e++){let s=a[e];for(let a=0;a<s.length;a++){let u=s[a],m=e===n.lineNumber&&u.startColumn<=n.column&&u.endColumn>=n.column;if(!d&&(e>n.lineNumber||e===n.lineNumber&&u.startColumn>n.column)){if(!(o.length>0))return[];for(let e of o)e.enclosesCursor=!0;d=!0}if("$"===u.tag){let l="$"===(null===(t=s[a+1])||void 0===t?void 0:t.tag)&&(null===(i=s[a+1])||void 0===i?void 0:i.startColumn)===u.endColumn;if(o.length>0&&("$"===o[o.length-1].tag||l&&"$$"===o[o.length-1].tag)){let t="$"===o[o.length-1].tag;m||(m=!t&&e===n.lineNumber&&u.startColumn===n.column-2);let i=o.pop();if(i&&((null==i?void 0:i.enclosesCursor)||m))return[r(i,i.line),r({startColumn:u.startColumn,endColumn:t?u.endColumn:u.startColumn+2},e)];t||a++}else o.push(l?{line:e,startColumn:u.startColumn,endColumn:u.startColumn+2,tag:"$$"}:Object.assign({line:e},u)),l&&a++}else if("\\("===u.tag||"\\["===u.tag||"{"===u.tag||u.tag.startsWith("\\begin"))o.push(Object.assign({line:e},u));else if("\\)"===u.tag||"\\]"===u.tag||"}"===u.tag||u.tag.startsWith("\\end")){let n=[...o];for(;o.length>0;){let t=o.pop();if(t&&l(t.tag)===u.tag){if((null==t?void 0:t.enclosesCursor)||m)return[r(t,t.line),r(u,e)];n=o;break}}o=n}if(m){if(!(o.length>0))return[];for(let e of o)e.enclosesCursor=!0;d=!0}}}return[]},n.validateModel=function(e,n){var a,s;let d=[],u=[],m=e._analyserResult;if(!m)return;let c=e.getLineCount(),g=void 0;for(let n=1;n<=c;n++){let c=m[n];for(let m=0;m<c.length;m++){let f=c[m],h=g&&(g.lineNumber>n||g.lineNumber===n&&g.column>f.startColumn);if("$"===f.tag){let e="$"===(null===(a=c[m+1])||void 0===a?void 0:a.tag)&&(null===(s=c[m+1])||void 0===s?void 0:s.startColumn)===f.endColumn;d.length>0&&("$"===d[d.length-1].tag||e&&"$$"===d[d.length-1].tag)?("$"!==d[d.length-1].tag&&m++,d.pop()):(d.push(e?{line:n,startColumn:f.startColumn,endColumn:f.startColumn+2,tag:"$$"}:Object.assign({line:n},f)),e&&m++)}else if("{"===f.tag||!h&&("\\("===f.tag||"\\["===f.tag||f.tag.startsWith("\\begin")))d.push(Object.assign({line:n},f));else if("}"===f.tag||!h&&("\\)"===f.tag||"\\]"===f.tag||f.tag.startsWith("\\end"))){let e=[...d],o=[];for(;d.length>0;){let n=d.pop();if(n){if(l(n.tag)===f.tag){e=d;break}o.push(Object.assign(Object.assign({},r(n,n.line)),{severity:t.MarkerSeverity.Error,message:i.getString("unmatched-bracket",n.tag)}))}}d===e?u.push(...o):(u.push(Object.assign(Object.assign({},r(f,n)),{severity:t.MarkerSeverity.Error,message:i.getString("unmatched-bracket",f.tag)})),d=e)}else h||"def"!==f.tag&&"newenv"!==f.tag&&"envdef"!==f.tag||(g=o(e,{lineNumber:n,column:f.startColumn},"def"===f.tag?1:"newenv"===f.tag?3:4))}}for(let e of d)u.push(Object.assign(Object.assign({},r(e,e.line)),{severity:t.MarkerSeverity.Error,message:i.getString("unmatched-bracket",e.tag)}));t.editor.setModelMarkers(e,n,u)}}),define("lib/CompletionItemProvider",["require","exports","monaco-editor","lib/common","lib/data","lib/structure"],function(e,n,t,i,o,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.btexCompletionItemProvider=void 0,n.btexCompletionItemProvider={triggerCharacters:["\\"],provideCompletionItems:function(e,n){var l,a,s,d,u,m,c,g,f,h;let p=[],v=e.getWordUntilPosition(n).word,b=null===(l=e.getWordAtPosition(n))||void 0===l?void 0:l.word,x=e.getValueInRange({startLineNumber:n.lineNumber,endLineNumber:n.lineNumber,startColumn:1,endColumn:n.column}),T=e.getLineContent(n.lineNumber).substring(x.length),C=x.match(/\\(?:begin|end)\s*\{([^\{\}\\\ud800-\udfff]*)$/);if(C){let l=T.match(/([^\{\}\\\ud800-\udfff]*)\}/),u=!l,m={startLineNumber:n.lineNumber,endLineNumber:n.lineNumber,startColumn:n.column-C[1].length,endColumn:n.column+(l?l[1].length+1:0)},c=r.detectMode(e,n);for(let e in o.environmentDictionary){let n=o.environmentDictionary[e];"T"===c&&"M"===n.mode||p.push({kind:null!==(a=n.kind)&&void 0!==a?a:t.languages.CompletionItemKind.Module,label:e,insertText:u?e+"}${0}\\end{"+e+"}":e+"}",insertTextRules:null!==(s=n.insertTextRules)&&void 0!==s?s:t.languages.CompletionItemInsertTextRule.InsertAsSnippet,range:m,detail:`\\begin{${e}}`+(null!==(d=n.signature)&&void 0!==d?d:""),tags:n.deprecated?[t.languages.CompletionItemTag.Deprecated]:void 0})}let g=function(e,n){const r=new RegExp("(?:"+[...o.envCommands,...o.envStarCommands].join("|").replace(/\\/g,"\\\\").replace(/\*/g,"\\*")+")\\s*\\{([a-zA-Z\\*]+)\\}","g");let l=new Set,a=!1,s=e.getLinesContent(),d=t.editor.getModel(t.Uri.file("/preamble"));d&&s.push(...d.getLinesContent());for(let e of s){if(e.length>i.options.maxParsedLineLength)continue;let t=e.match(r);if(t)for(let e of t){let t=e.match(/\{([a-zA-Z\*]+)\}/);if(t)if((e=t[1])===n)a?n=void 0:a=!0;else if(e in o.environmentDictionary||l.has(e)||l.add(e),l.size>i.options.suggestionsLimit)return l}}return l}(e,b);for(let e of g)p.push({kind:t.languages.CompletionItemKind.Module,label:e,insertText:u?e+"}${0}\\end{"+e+"}":e+"}",insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet,range:m,detail:`\\begin{${e}}`});return{suggestions:p}}if(/^\\[a-zA-Z]*$/.test(v)&&!/(^|[^\\#]|#\\)(\\\\)+$/.test(x)&&!/#\\[a-zA-Z]*$/.test(x)){let l=r.detectMode(e,n.delta(0,-v.length));for(let e in o.snippetDictionary){let n=o.snippetDictionary[e];"T"===l&&"M"===n.mode||p.push({kind:null!==(u=n.kind)&&void 0!==u?u:"M"===n.mode?t.languages.CompletionItemKind.Field:t.languages.CompletionItemKind.Method,label:e,insertText:null!==(m=n.insertText)&&void 0!==m?m:e,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet,detail:null!==(c=n.signature)&&void 0!==c?c:e,tags:n.deprecated?[t.languages.CompletionItemTag.Deprecated]:void 0})}for(let e in o.commandDictionary){let n=o.commandDictionary[e];"T"===l&&"M"===n.mode||p.push({kind:null!==(g=n.kind)&&void 0!==g?g:"M"===n.mode?t.languages.CompletionItemKind.Field:t.languages.CompletionItemKind.Method,label:e,insertText:null!==(f=n.insertText)&&void 0!==f?f:e,insertTextRules:n.insertTextRules,detail:null!==(h=n.signature)&&void 0!==h?h:e,tags:n.deprecated?[t.languages.CompletionItemTag.Deprecated]:void 0})}let a=function(e,n){const r=/\\([a-zA-Z]+)/g;let l=new Set,a=e.getLinesContent(),s=t.editor.getModel(t.Uri.file("/preamble"));s&&a.push(...s.getLinesContent());for(let e of a){if(e.length>i.options.maxParsedLineLength)continue;let t=e.match(r);if(t)for(let e of t)if(e===n)n=void 0;else if(e in o.commandDictionary||l.has(e)||l.add(e),l.size>i.options.suggestionsLimit)return l}return l}(e,b);for(let e of a)p.push({kind:t.languages.CompletionItemKind.Method,label:e,insertText:e,detail:e});let s=r.matchEnvironment(e,null,n,-1);if(s){let n=e.getValueInRange({startLineNumber:s.lineNumber,endLineNumber:s.lineNumber,startColumn:s.column,endColumn:e.getLineLength(s.lineNumber)+1}).match(/^[^\{\}\\]*(?=\})/);n&&(p=p.filter(e=>"\\end"!==e.label)).push({kind:t.languages.CompletionItemKind.Method,label:`\\end{${n[0]}}`,insertText:`\\end{${n[0]}}`,detail:`\\end{${n[0]}}`})}}return{suggestions:p}}}}),define("lib/handlers",["require","exports","monaco-editor","diff","lib/common","lib/structure","lib/StructureAnalyser"],function(e,n,t,i,o,r,l){"use strict";function a(e,n){n&&n.reason!==t.editor.CursorChangeReason.Explicit||setTimeout(()=>{var n;let i=e.getModel(),o=e.getPosition();if(!i||!o)return;let l=null!==(n=i._bracketsDecorations)&&void 0!==n?n:[],a=r.getHighlightBrackets(i,o),s=i.deltaDecorations(l,a.map(e=>({options:{className:"bracket-match",stickiness:t.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges},range:e})));i._bracketsDecorations=s},0)}Object.defineProperty(n,"__esModule",{value:!0}),n.onDidChangeCursorPosition=n.onDidChangeModelContent=void 0,n.onDidChangeModelContent=function(e,n){var s;let d=n.changes;if(d.length>1){let n=null!==(s=e._oldValue)&&void 0!==s?s:"";var u=t.editor.createModel(n,"btex");d=d.filter(e=>!(""===e.text&&e.range.startLineNumber===e.range.endLineNumber&&1===e.range.startColumn&&e.range.endColumn===u.getLineLength(e.range.startLineNumber)+1&&/^\s+$/.test(u.getLineContent(e.range.startLineNumber))))}let m=e._validateTimeout;void 0!==m&&clearTimeout(m),e._validateTimeout=setTimeout(()=>{let n=e.getModel();n&&r.validateModel(n,e.getId()),delete e._validateTimeout},500),setTimeout(()=>{var s,m,c,g,f,h,p,v,b,x;let T=e.getModel(),C=e.getPosition();if(!T||!C)return;let w=null!==(s=e._oldValue)&&void 0!==s?s:"";e._oldValue=e.getValue();let y=!1;for(let e of d)if(e.range.startLineNumber!==e.range.endLineNumber||e.text.includes("\n")){y=!0;break}let L=null!==(m=T._analyserResult)&&void 0!==m?m:{};if(y)L=l.btexStructureAnalyser.analyse(T);else for(let e of d)Object.assign(L,l.btexStructureAnalyser.analyse(T,e.range));T._analyserResult=L;let k=e._diffSource;if(void 0!==k){let n=i.diffLines(k,T.getValue()),o=[],r=1,l=0;for(let e=0;e<n.length;e++){let i=n[e];if(i.added)o.push({range:new t.Range(r,1,r+(null!==(c=i.count)&&void 0!==c?c:1)-1,1),options:{isWholeLine:!0,linesDecorationsClassName:"line-dec-added",minimap:{color:"#81b88b",position:t.editor.MinimapPosition.Gutter}}}),r+=null!==(g=i.count)&&void 0!==g?g:1,l+=null!==(f=i.count)&&void 0!==f?f:1;else if(i.removed){let a=r;l+=null!==(h=i.count)&&void 0!==h?h:1,e+1<n.length&&n[e+1].added&&(r+=null!==(p=n[e+1].count)&&void 0!==p?p:1,l+=null!==(v=n[e+1].count)&&void 0!==v?v:1,e++),o.push({range:new t.Range(a,1,a===r?r:r-1,1),options:{isWholeLine:!0,linesDecorationsClassName:a===r?"line-dec-removed":"line-dec-modified",minimap:{color:a===r?"#ca4b51":"#66afe0",position:t.editor.MinimapPosition.Gutter}}})}else r+=null!==(b=i.count)&&void 0!==b?b:1}l>200&&(o=[],delete e._diffSource);let a=null!==(x=T._diffDecorations)&&void 0!==x?x:[],s=e.deltaDecorations(a,o);T._diffDecorations=s}if(n.isUndoing||n.isRedoing||1!==d.length)return;let M=T.getValueInRange({startLineNumber:C.lineNumber,endLineNumber:C.lineNumber,startColumn:1,endColumn:C.column}),$=T.getLineContent(C.lineNumber);if($.length>o.options.maxParsedLineLength)return;let N=d[0].text;if("$"===N&&M.endsWith("$$")&&o.insertText(e,C,"$$"),"\\begin{".endsWith(N)&&M.endsWith("{")&&""!==N)return void e.trigger(null,"editor.action.triggerSuggest",void 0);let S=M.match(/\\begin\s*\{([^\{\}\\\s]*)\}$/);S&&"}"===N&&!$.substr(M.length).trim().startsWith(`\\end{${S[1]}}`)&&o.insertText(e,C,`\\end{${S[1]}}`),(S=M.match(/\\begin\s*\{$/))&&"{}"===N&&o.insertText(e,C,"}\\end{}",C,1);let P=(S=M.match(/\\(begin|end)\s*\{([^\{\}\\]*)(\}?)$/))&&S[3]&&N===S[2]+"}";if(S&&(P||!S[3])&&(P||N.length<=S[2].length)&&d[0].range.endLineNumber===C.lineNumber&&d[0].range.startColumn===C.column-d[0].text.length){P||setTimeout(()=>{e.trigger(null,"editor.action.triggerSuggest",void 0)},0);let n=(null!=u?u:t.editor.createModel(w,"btex")).getLineContent(C.lineNumber).substring(S.index).match(/\\(begin|end)\s*\{([^\{\}\\]*)\}/),i=$.substring(S.index).match(/\\(begin|end)\s*\{([^\{\}\\]*)\}/);if(n&&i){let t=n[2],l=i[2],a="begin"===i[1]?1:-1,s=r.matchEnvironment(T,t,C,a),d=Object.assign({},C);(null==s?void 0:s.lineNumber)===C.lineNumber&&-1===a&&(d.column+=l.length-t.length),s&&/^[^\ud800-\udfff]*$/.test(t)&&o.insertText(e,s,l,d,t.length)}}a(e)},0)},n.onDidChangeCursorPosition=a}),define("lib/LanguageConfiguration",["require","exports","monaco-editor"],function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.btexLanguageConfiguration=void 0,n.btexLanguageConfiguration={autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:"\\{",close:"\\}"},{open:"\\[",close:"\\]"},{open:"\\(",close:"\\)"},{open:"`",close:"'"},{open:"$",close:"$",notIn:["comment"]}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:"`",close:"'"},{open:"$",close:"$"}],brackets:[],comments:{lineComment:"%"},indentationRules:{increaseIndentPattern:/\\begin\s*\{[^\{\}\\]*\}(?!.*\\(begin|end)\s*\{)/,decreaseIndentPattern:/^\s*\\end\s*\{/},wordPattern:/\\(@*[a-zA-Z]*)|[^\s\d`~!@#$%^&*()\-=_+[\]{}\\\|;:'"<>,.\/?\u0500-\uffff]+/g,onEnterRules:[{beforeText:/\\begin\s*\{[^\{\}\\]*\}(?!.*\\(begin|end)\s*\{)/,afterText:/^\s*\\end\s*\{/,action:{indentAction:t.languages.IndentAction.IndentOutdent}},{beforeText:/\\begin\s*\{[^\{\}\\]*\}(?!.*\\(begin|end)\s*\{)/,action:{indentAction:t.languages.IndentAction.Indent}},{beforeText:/\$\$\s*$/,afterText:/^\s*\$\$/,action:{indentAction:t.languages.IndentAction.IndentOutdent}},{beforeText:/\\\[\s*$/,afterText:/^\s*\\\]/,action:{indentAction:t.languages.IndentAction.IndentOutdent}},{beforeText:/\\\(\s*$/,afterText:/^\s*\\\)/,action:{indentAction:t.languages.IndentAction.IndentOutdent}},{beforeText:/\{\s*$/,afterText:/^\s*\}/,action:{indentAction:t.languages.IndentAction.IndentOutdent}}]}}),define("lib/TokensProvider",["require","exports","lib/data"],function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.btexTokensProvider=void 0,n.btexTokensProvider={envCommands:t.envCommands,envStarCommands:t.envStarCommands,mathEnvironments:t.mathEnvironments.map(e=>"{"+e+"}"),defaultToken:"text",tokenizer:{root:[{include:"@common"},[/\\begin(?=\s*\{)/,"command","@begin"],[/\\@?[aegpt@]?def(?![a-zA-Z])/,{token:"command",next:"@def.1"}],[/(\\@?(?:re)?newcommand)(\s*)(\**)(\s*)(\{)(\s*)(\\(?:[a-zA-Z]+|.))(\s*)(\})/,["command","","text","","delimiter.curly","","command","",{token:"delimiter.curly",next:"@def.1"}]],[/(\\@?(?:re)?newcommand)(\s*)(\**)(\s*)(\\(?:[a-zA-Z]+|.))/,["command","","text","",{token:"command",next:"@def.1"}]],[/(\\@?(?:re)?newenvironment)(\s*)(\**)(\s*)(\{)([^\{\}\\]*)(\})/,["command","","text","","delimiter.curly","string.env",{token:"delimiter.curly",next:"@def.2"}]],[/(\\@?env[ap]?def)(\s*)(\**)(\s*)(\{)([^\{\}\\]*)(\})/,["command","","text","","delimiter.curly","string.env",{token:"delimiter.curly",next:"@def.3"}]],[/(\\@?(?:re)?newenvironment)(\s*)(\**)(\s*)(\{)/,["command","","text","",{token:"@rematch",next:"@def.3"}]],[/(\\@?env[ap]?def)(\s*)(\**)(\s*)(\{)/,["command","","text","",{token:"@rematch",next:"@def.4"}]],{include:"@commands"},[/./,"text"]],math:[[/[\^_]/,"text.special"],[/\\begin(?=\s*\{)/,"command","@begin"],[/\\[\\]/,"command"],[/\{/,"delimiter.curly","math.group"],{include:"@commands.math"},{include:"@common"},[/./,"text.math"]],common:[[/[\{\}]/,"delimiter.curly"],[/[\(\)\[\]]/,"delimiter"],[/[&~]/,"text.special"],[/#+[+-]?([a-zA-Z]+|.?)/,"argument"],[/%/,"@rematch","@comment"]],comment:[[/.*/,"comment","@pop"]],begin:[[/(\{)([^\{\}\\]*)(\})/,{cases:{"@mathEnvironments":["delimiter.curly","string.env",{token:"delimiter.curly",next:"@math.env"}],"@default":["delimiter.curly","string.env",{token:"delimiter.curly",next:"@pop"}]}}],[/\s/,""],[/./,"@rematch","@pop"]],end:[[/(\{)([^\{\}\\]*)(\})/,{cases:{"@mathEnvironments":["delimiter.curly","string.env",{token:"delimiter.curly",next:"@popall"}],"@default":["delimiter.curly","string.env",{token:"delimiter.curly",next:"@pop"}]}}],[/\s/,""],[/./,"@rematch","@pop"]],env:[[/(\{)([^\{\}\\]*)(\})/,["delimiter.curly","string.env",{token:"delimiter.curly",next:"@pop"}]],[/\s/,""],[/./,"@rematch","@pop"]],"math.env":[[/\\end(?=\s*\{)/,"delimiter.command","@end"],{include:"@math"}],"math.double":[[/\$\$/,"delimiter.command","@popall"],{include:"@math"}],"math.single":[[/\$/,"delimiter.command","@pop"],{include:"@math"}],"math.[":[[/\\\]/,"delimiter.command","@popall"],{include:"@math"}],"math.(":[[/\\\)/,"delimiter.command","@pop"],{include:"@math"}],"math.group":[[/\{/,"delimiter.curly","@push"],[/\}/,"delimiter.curly","@pop"],{include:"@math"}],"def.1":[[/\{/,"delimiter.curly","@def.group.1"],{include:"@common"},{include:"@commands.nomath"}],"def.2":[[/\{/,"delimiter.curly","@def.group.2"],{include:"@common"},{include:"@commands.nomath"}],"def.3":[[/\{/,"delimiter.curly","@def.group.3"],{include:"@common"},{include:"@commands.nomath"}],"def.4":[[/\{/,"delimiter.curly","@def.group.4"],{include:"@common"},{include:"@commands.nomath"}],"def.group.1":[[/\{/,"delimiter.curly","@def.group"],[/\}/,"delimiter.curly","@popall"],{include:"@common"},{include:"@commands.nomath"}],"def.group.2":[[/\{/,"delimiter.curly","@def.group"],[/(\})(\s*)(\{)/,["delimiter.curly","",{token:"delimiter.curly",next:"@def.group.1"}]],[/\}/,"delimiter.curly","@popall"],{include:"@common"},{include:"@commands.nomath"}],"def.group.3":[[/\{/,"delimiter.curly","@def.group"],[/(\})(\s*)(\{)/,["delimiter.curly","",{token:"delimiter.curly",next:"@def.group.2"}]],[/\}/,"delimiter.curly","@popall"],{include:"@common"},{include:"@commands.nomath"}],"def.group.4":[[/\{/,"delimiter.curly","@def.group"],[/(\})(\s*)(\{)/,["delimiter.curly","",{token:"delimiter.curly",next:"@def.group.3"}]],[/\}/,"delimiter.curly","@popall"],{include:"@common"},{include:"@commands.nomath"}],"def.group":[[/\{/,"delimiter.curly","@push"],[/\}/,"delimiter.curly","@pop"],{include:"@common"},{include:"@commands.nomath"}],commands:[[/\$\$/,"delimiter.command","@math.double"],[/\$/,"delimiter.command","@math.single"],[/\\\[/,"delimiter.command","@math.["],[/\\\(/,"delimiter.command","@math.("],[/(\\[a-zA-Z]+)(\*)/,{cases:{"@envStarCommands":["command",{token:"text",next:"@env"}],"@default":["command","text"]}}],[/\\(@*[a-zA-Z]+|@+|.?)/,{cases:{"@envCommands":{token:"command",next:"@env"},"@default":"command"}}]],"commands.math":[[/\$\$/,"delimiter.command","@math.double"],[/\$/,"delimiter.command","@math.single"],[/\\\[/,"delimiter.command","@math.["],[/\\\(/,"delimiter.command","@math.("],[/(\\[a-zA-Z]+)(\*)/,{cases:{"@envStarCommands":["command",{token:"text",next:"@env"}],"@default":["command.math","text"]}}],[/\\(@*[a-zA-Z]+|@+|.?)/,{cases:{"@envCommands":{token:"command",next:"@env"},"@default":"command.math"}}]],"commands.nomath":[[/\$/,"delimiter.command"],[/\\\[/,"delimiter.command"],[/\\\(/,"delimiter.command"],[/(\\[a-zA-Z]+)(\*)/,{cases:{"@envStarCommands":["command",{token:"text",next:"@env"}],"@default":["command","text"]}}],[/\\(@*[a-zA-Z]+|@+|.?)/,{cases:{"@envCommands":{token:"command",next:"@env"},"@default":"command"}}]]},brackets:[{open:"{",close:"}",token:"delimiter.curly"}]}}),define("lib/StorageService",["require","exports"],function(e,n){"use strict";function t(e){return null==e}Object.defineProperty(n,"__esModule",{value:!0}),n.StorageService=void 0;n.StorageService=class{constructor(){this.globalCache=new Map,this.workspaceCache=new Map}getCache(e){return 0===e?this.globalCache:this.workspaceCache}get(e,n,i){const o=this.getCache(n).get(e);return t(o)?i:o}getBoolean(e,n,i){const o=this.getCache(n).get(e);return t(o)?i:"true"===o}getNumber(e,n,i){const o=this.getCache(n).get(e);return t(o)?i:parseInt(o,10)}store(e,n,i){if(t(n))return this.remove(e,i);const o=String(n);this.getCache(i).set(e,o)}remove(e,n){this.getCache(n).delete(e)}onWillSaveState(){}onDidChangeStorage(){}}}),define("lib/themes",["require","exports"],function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.btexLightTheme=void 0,n.btexLightTheme={base:"vs",inherit:!1,rules:[{token:"keyword",foreground:"f87000"},{token:"command",foreground:"f87000"},{token:"attribute.value",foreground:"f87000"},{token:"tag",foreground:"f8a000"},{token:"command.math",foreground:"f8a000"},{token:"delimiter",foreground:"40484c"},{token:"delimiter.command",foreground:"f87000"},{token:"delimiter.css",foreground:"687074"},{token:"delimiter.html",foreground:"a0a8b0"},{token:"attribute.name",foreground:"30a0e0"},{token:"argument",foreground:"30a0e0"},{token:"string",foreground:"70a000"},{token:"identifier",foreground:"40484c"},{token:"text",foreground:"40484c"},{token:"text.math",foreground:"687074"},{token:"text.special",foreground:"f87000"},{token:"comment",foreground:"a0a0a0"}],colors:{"editorLineNumber.foreground":"#c4d0d4","editorLineNumber.activeForeground":"#78848c","editor.lineHighlightBackground":"#8098a018","editor.lineHighlightBorder":"transparent","editor.selectionBackground":"#0090d028","minimap.selectionHighlight":"#0090d050","menu.selectionBackground":"#0090d028","menu.selectionForeground":"#404040"}}}),define("lib/DefinitionProvider",["require","exports","monaco-editor","lib/common","lib/data"],function(e,n,t,i,o){"use strict";function r(e,n){n.startsWith("\\")&&(n=n.substring(1));let t=new RegExp("(\\\\@?([aegpt@]?def|[apt@]?let|(re)?newcommand\\s*\\*?\\s*\\{?)\\s*)\\\\"+(/^@?@?[a-zA-Z]+/.test(n)?`${n}(?![a-zA-Z])`:`\\${n}`)),o=e.getLinesContent(),r=[];for(let n=0;n<o.length;n++){let l=o[n];if(l.length>i.options.maxParsedLineLength)continue;let a=(l=l.replace(/\\\\/g,"  ").replace(/(^|[^\\])%.*/,"$1")).match(t);a&&r.push({range:{startLineNumber:n+1,endLineNumber:n+1,startColumn:1+a.index+a[1].length,endColumn:1+a.index+a[0].length},uri:e.uri})}return r}Object.defineProperty(n,"__esModule",{value:!0}),n.overrideGoToDefinition=n.btexDefinitionProvider=void 0,n.btexDefinitionProvider={provideDefinition:function(e,n){let i=e.getValueInRange({startLineNumber:n.lineNumber,endLineNumber:n.lineNumber,startColumn:1,endColumn:n.column}).replace(/\\\\/g,"  ").replace(/(^|[^\\])%.*/,"$1"),l=e.getLineContent(n.lineNumber),a=i.match(/\\(@?@?[a-zA-Z]+|[^@]?)$/);if(a){let n=l.substring(a.index).match(/^\\(@?@?[a-zA-Z]+|[^@]?)/)[0];if(/^\\(@@.*|)$/.test(n))return[];let i=r(e,n);for(let e of o.imports){let o=t.editor.getModel(e.uri);o&&i.push(...r(o,n))}return 0===i.length?null:i}}},n.overrideGoToDefinition=function(e){const n=e._codeEditorService,t=n.openCodeEditor.bind(n);n.openCodeEditor=((e,n)=>__awaiter(this,void 0,void 0,function*(){const i=yield t(e,n);return null===i&&n.trigger(null,"editor.action.peekDefinition",void 0),i}))}}),define("btex-monaco",["require","exports","monaco-editor","lib/common","lib/CompletionItemProvider","lib/handlers","lib/LanguageConfiguration","lib/TokensProvider","lib/themes","lib/DefinitionProvider","lib/data"],function(e,n,t,i,o,r,l,a,s,d,u){"use strict";function m(e,n){let i=t.Uri.file(e);u.imports.push({uri:i,content:n}),t.editor.createModel(n,"btex",i)}Object.defineProperty(n,"__esModule",{value:!0}),n.addImport=n.createEditor=n.setLocale=void 0,navigator.clipboard.readText||(navigator.clipboard.readText=function(){return new Promise(e=>e(""))}),function(){t.languages.register({id:"btex"}),t.languages.setMonarchTokensProvider("btex",a.btexTokensProvider),t.languages.setLanguageConfiguration("btex",l.btexLanguageConfiguration),t.languages.registerCompletionItemProvider("btex",o.btexCompletionItemProvider),t.languages.registerDefinitionProvider("btex",d.btexDefinitionProvider),t.editor.defineTheme("btex-light",s.btexLightTheme),fetch(u.initFileUrl).then(e=>__awaiter(this,void 0,void 0,function*(){m("/init.btx",yield e.text())}))}(),n.setLocale=function(e){i.options.locale=e},n.createEditor=function(e,n,i,o="btex",l){let a=t.editor.create(e,{language:o,theme:"btex-light",fontFamily:'"Cascadia Code", "Microsoft YaHei UI", "Microsoft YaHei", sans-serif',fontSize:16,readOnly:l});return"btex"===o&&function(e){e.updateOptions({detectIndentation:!1,wordBasedSuggestions:!1,wordSeparators:"`~!#$%^&*()-_=+[{]}\\|;:'\",.<>/?"}),e.onDidChangeModelContent(n=>r.onDidChangeModelContent(e,n)),e.onDidChangeCursorPosition(n=>r.onDidChangeCursorPosition(e,n)),d.overrideGoToDefinition(e)}(a),a.setValue(null!=n?n:""),a._diffSource=null!=i?i:"",a},n.addImport=m}),require(["btex-monaco"],function(e){/mobi/i.test(window.navigator.userAgent)?$("textarea#wpTextbox1").addClass("b-unhide"):(e.setLocale("zh"),docReady(function(){if(window.monacoEditorData){let n=$("textarea#wpTextbox1");n.css("display","none"),$div=$('<div id="btex-monaco-container" class="btex-monaco-container">'),$div.insertBefore(n);let t=window.monacoEditorData,i=e.createEditor(document.getElementById("btex-monaco-container"),n.val(),t.oldText,t.lang,t.readOnly);t.preamble&&e.addImport("/preamble",t.preamble),i.onDidChangeModelContent(function(){n.val(i.getValue())}),window.monacoEditor=i}}))});